
USE [DB]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[miTabla_SP]
	@TABLA [dbo].ATT_TRAN_SERVICES_OFFER_TT readonly
	--@TIPO VARCHAR(20) = 'HOY'
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @MIFECHAHOY DATETIME 
		SET @MIFECHAHOY = DATEADD(d,DATEDIFF(d,0,CAST(GETDATE() AS DATE)),0)
		SELECT @MIFECHAHOY
						MERGE [DB].[dbo].[miTabla] AS T
				USING(
					SELECT 
						[TRANSACTION_ID]
						,[CHANNEL]
						,[OPERATION]
					FROM @TABLA 
					--WHERE [FECHA_RECARGA] >= @MIFECHAHOY
					)  AS S ON
					T.[TRANSACTION_ID] = S.[TRANSACTION_ID]
				WHEN MATCHED THEN UPDATE SET 
	      T.[TRANSACTION_ID] = S.[TRANSACTION_ID]
				T.[CHANNEL] = S.[CHANNEL],
				T.[OPERATION] = S.[OPERATION]
				WHEN NOT MATCHED BY TARGET THEN INSERT 
				(
					[TRANSACTION_ID], [CHANNEL],[MONTO_PLAN],[OPERATION]
				) VALUES 
				(
					S.[TRANSACTION_ID],S.[CHANNEL],S.[OPERATION]
				)
